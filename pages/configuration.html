<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            box-sizing: border-box;
        }

        body,
        html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .tablink {
            background-color: #6262b6;
            color: white;
            float: left;
            border: none;
            cursor: pointer;
            padding: 12px 16px;
            font-size: 16px;
            width: 50%;
            transition: background 0.3s;
        }

        .tablink:hover {
            background-color: #44ca92;
        }

        .tabcontent {
            display: none;
            padding: 30px 20px;
            background-color: #e0dede;
            color: #222;
            height: calc(100vh - 50px);
            overflow-y: auto;
        }

        /* Alineaci贸n horizontal de label + input */
        .form-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        label {
            min-width: 180px;
            font-weight: bold;
        }

        input,
        select {
            padding: 8px;
            flex: 1;
            max-width: 300px;
        }

        button.folder {
            background-color: #888;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        button.folder:hover {
            background-color: #555;
        }

        button.save {
            margin-top: 25px;
            padding: 10px 15px;
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button.save:hover {
            background-color: #005fa3;
        }

        button.cancel {
            margin-top: 25px;
            padding: 10px 15px;
            background-color: #e90000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button.cancel:hover {
            background-color: #b80202;
        }

        .toast {
            min-width: 200px;
            margin-top: 10px;
            padding: 12px 18px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            background-color: #28a745;
        }

        .toast.error {
            background-color: #dc3545;
        }
    </style>
</head>

<body>

    <!-- Tabs -->
    <button class="tablink" onclick="openPage('Monitor', this, '#444')" id="defaultOpen">Monitor</button>
    <button class="tablink" onclick="openPage('Gestor', this, '#444')">Gestor</button>

    <!-- Monitor -->
    <div id="Monitor" class="tabcontent">
        <h2>Configuraci贸n general</h2>
        <form id="monitorForm">
            <div class="form-row">
                <label for="sample-interval">Intervalo de muestreo:</label>
                <input type="number" id="sample-interval" name="sample-interval" min="10" max="3600" value="60"
                    step="10">
            </div>

            <div class="form-row">
                <label for="sessionPath">Ruta de sesiones:</label>
                <input type="text" id="sessionPath" name="sessionPath" readonly required
                    placeholder="Selecciona una carpeta..." />
                <button type="button" class="folder" onclick="selectFolder()"></button>
            </div>

            <div class="form-row">
                <button type="button" class="save" onclick="saveSettings('monitorForm')">Guardar</button>
                <button type="button" class="cancel" onclick="cancelSettings('monitorForm')">Cancelar</button>

            </div>
        </form>
    </div>

    <!-- Gestor -->
    <div id="Gestor" class="tabcontent">
        <h2>Gestor de adaptaciones</h2>
        <form id="gestorForm">
            <div class="form-row">
                <label for="modo">Modo de funcionamiento:</label>
                <select id="modo" name="modo">
                    <option value="automatico">Autom谩tico</option>
                    <option value="sugerencia">Sugerencia</option>
                </select>
            </div>

            <div class="form-row">
                <button type="button" class="save" onclick="saveSettings('gestorForm')">Guardar</button>
                <button type="button" class="cancel" onclick="cancelSettings('gestorForm')">Cancelar</button>

            </div>
        </form>
    </div>
    <!-- Contenedor para toasts -->
    <div id="toastContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;"></div>

    <script>
        // --- Cargar configuraci贸n al iniciar ---
        window.addEventListener('DOMContentLoaded', async () => {
            if (!window.electronAPI) return;

            const config = await window.electronAPI.getConfig();
            console.log("Configuraci贸n actual:", config);

            // Rellenar los formularios
            if (config.monitor) {
                document.getElementById('sample-interval').value = config.monitor.sampleInterval ?? 60;
                document.getElementById('sessionPath').value = config.monitor.sessionPath ?? '';
            }

            if (config.gestor) {
                document.getElementById('modo').value = config.gestor.modo ?? 'automatico';
            }
        });

        // --- Tabs ---
        function openPage(pageName, elmnt) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            const tablinks = document.getElementsByClassName("tablink");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "";
            }
            document.getElementById(pageName).style.display = "block";
            elmnt.style.backgroundColor = "#303057";
        }

        document.getElementById("defaultOpen").click();

        // --- Selecci贸n de carpeta ---
        async function selectFolder() {
            if (window.electronAPI && window.electronAPI.selectDirectory) {
                const folderPath = await window.electronAPI.selectDirectory();
                if (folderPath) {
                    document.getElementById("sessionPath").value = folderPath;
                }
            } else {
                alert("API de Electron no disponible");
            }
        }

        async function saveSettings(formId) {
            const form = document.getElementById(formId);
            const data = {};
            for (let element of form.elements) {
                if (element.name) data[element.name] = element.value;
            }

            let update = {};
            if (formId === 'monitorForm') update = { monitor: data };
            if (formId === 'gestorForm') update = { gestor: data };

            if (window.electronAPI) {
                window.electronAPI.updateConfig(update);
                showToast("Configuraci贸n aplicada y guardada (" + formId + ")", "success");
            }
        }


        function cancelSettings(formId) {
            const form = document.getElementById(formId);
            form.reset();
            showToast("Cambios descartados (" + formId + ")", "error");
        }

        function showToast(message, type = 'success', duration = 3000) {
            const container = document.getElementById('toastContainer');

            const toast = document.createElement('div');
            toast.classList.add('toast', type);
            toast.textContent = message;

            container.appendChild(toast);

            // Animaci贸n de entrada
            setTimeout(() => toast.classList.add('show'), 10);

            // Desaparece despu茅s de duration ms
            setTimeout(() => {
                toast.classList.remove('show');
                // eliminar del DOM tras la animaci贸n
                setTimeout(() => container.removeChild(toast), 300);
            }, duration);
        }


    </script>

</body>

</html>